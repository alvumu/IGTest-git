<ul class="list">
{%- assign pathContains = include.pathContains | default: '' -%}
{%- assign nameContains = include.nameContains | default: '' -%}
{%- assign excludeIndex = include.excludeIndex | default: true -%}

{%- comment -%} Toma todas las p√°ginas que realmente generan HTML {%- endcomment -%}
{%- assign pages = site.pages | where_exp: "p", "p.output_ext == '.html'" -%}

{%- comment -%} Filtra por carpeta de origen dentro de input/pagecontent (copiada a temp/pages) {%- endcomment -%}
{%- if pathContains != '' -%}
  {%- assign pages = pages | where_exp:'p','p.path contains pathContains' -%}
{%- endif -%}

{%- comment -%} Opcional: filtra por subcadena en el nombre/archivo {%- endcomment -%}
{%- if nameContains != '' -%}
  {%- assign needle = nameContains | downcase -%}
  {%- assign filtered = '' | split: '' -%}
  {%- for p in pages -%}
    {%- assign fname = p.name | default:p.path | downcase -%}
    {%- if fname contains needle -%}
      {%- assign filtered = filtered | push:p -%}
    {%- endif -%}
  {%- endfor -%}
  {%- assign pages = filtered -%}
{%- endif -%}

{%- comment -%} Excluye el index.md de esa carpeta si aplica {%- endcomment -%}
{%- if excludeIndex and pathContains != '' -%}
  {%- assign pages = pages | where_exp:'p','p.path contains "/index.md" | not' -%}
  {%- assign pages = pages | where_exp:'p','p.path contains "index.md" | not' -%}
{%- endif -%}

{%- assign pages = pages | uniq | sort:'title' -%}

{%- for p in pages -%}
  {%- assign title = p.title | default:p.name | default:p.url -%}
  <li><a href="{{ p.url | relative_url }}">{{ title }}</a></li>
{%- endfor -%}

{%- if pages == empty -%}
  <li><em>No entries found{% if pathContains != '' %} (dir={{ pathContains }}){% endif %}</em></li>
{%- endif -%}
</ul>
